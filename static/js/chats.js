(()=>{"use strict";class e{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){if(!this.listeners[e])throw new Error("Нет события: "+e);this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){if(!this.listeners[e])throw new Error("Нет события: "+e);this.listeners[e].forEach((function(e){e(...t)}))}}class t{constructor(s){this._element=null,this._mounted=!1,this.setProps=e=>{e&&Object.assign(this.props,e)};const n=new e;this.props=this._makePropsProxy(s),this.eventBus=()=>n,this._registerEvents(n),n.emit(t.EVENTS.INIT)}_registerEvents(e){e.on(t.EVENTS.INIT,this.init.bind(this)),e.on(t.EVENTS.FLOW_CDM,this._componentDidMount.bind(this)),e.on(t.EVENTS.FLOW_RENDER,this._render.bind(this)),e.on(t.EVENTS.FLOW_SCDU,this._shouldComponentDidUpdate.bind(this)),e.on(t.EVENTS.FLOW_CDU,this._componentDidUpdate.bind(this))}init(){this._prerender(),this._render()}_componentDidMount(){this.componentDidMount()}componentDidMount(){}_shouldComponentDidUpdate(e,s){this.shouldComponentUpdate(e,s)&&this.eventBus().emit(t.EVENTS.FLOW_RENDER)}shouldComponentUpdate(e,t){return e!==t}_componentDidUpdate(){this.componentDidUpdate()}componentDidUpdate(){}_render(){const e=this.render();this._mounted&&null!==this._element&&null!==e?this._element instanceof HTMLElement&&(this._element.replaceWith(e),this._element=e):this._element=e,this._mounted?this.eventBus().emit(t.EVENTS.FLOW_CDU):(this.eventBus().emit(t.EVENTS.FLOW_CDM),this._mounted=!0)}render(){return null}get element(){return this._element}getContent(){return this.element}_makePropsProxy(e){return new Proxy(e,{set:(e,s,n)=>(e[s]=n,this.eventBus().emit(t.EVENTS.FLOW_SCDU),!0)})}show(e="block"){this._element instanceof HTMLElement&&"none"===this._element.style.display&&(this._element.style.display=e,this.eventBus().emit(t.EVENTS.FLOW_CDU))}hide(){this._element instanceof HTMLElement&&"none"!==this._element.style.display&&(this._element.style.display="none",this.eventBus().emit(t.EVENTS.FLOW_CDU))}visibilityToggle(e="block"){this._element instanceof HTMLElement&&("none"===this._element.style.display?this.show(e):this.hide())}forceUpdate(){this.eventBus().emit(t.EVENTS.FLOW_RENDER)}_prerender(){this.prerender()}prerender(){}}t.EVENTS={INIT:"init",FLOW_CDM:"flow:component-did-mount",FLOW_RENDER:"flow:render",FLOW_SCDU:"flow:should-component-did-update",FLOW_CDU:"flow:component-did-update"};const s=new class extends class{constructor(){this._allowed=null,this.EVENTS={onBlur:"blur",onChange:"input",onClick:"click",onSubmit:"submit"},this.SVG_TAGS=["svg","circle","path","stroke","rect","line"]}_createNode(e,t){if("string"==typeof e){let s=e;const n=(e.match(/{{ (\w+) }}/g)||[]).reduce(((e,t)=>e.includes(t)?e:[...e,t.replace(/({)|(})|( )/g,"")]),[]),a=document.createDocumentFragment();for(const e of n){const n=new RegExp(`{{ ${e} }}`,"g");if(null!==this._allowed){if(t[e]instanceof this._allowed){const s=t[e].getContent();null!==s&&a.appendChild(s)}Array.isArray(t[e])&&t[e].forEach((e=>{const t=e.getContent();null!==t&&a.appendChild(t)}))}s=s.replace(n,t[e]||"")}return Array.from(a.children).length>0?a:document.createTextNode(s)}const{children:s,fullTag:n,tag:a}=e;if("<>"===a){const e=document.createDocumentFragment();return s.forEach((s=>{e.appendChild(this._createNode(s,t))})),e}const i=this.SVG_TAGS.includes(a)?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a),r=n.match(/([a-zA-Z0-9-]+)="(.*?)"/g);if(null!==r){const e=/(?<prop>[a-zA-Z0-9-]+)(="(?<value>.*?)")?/;r.forEach((s=>{var n;const{prop:a,value:r=""}=null===(n=s.match(e))||void 0===n?void 0:n.groups;let c=r;const o=null==r?void 0:r.match(/{{ (\w+) }}/);if(null!=o&&void 0!==o[1])if("function"==typeof t[o[1]])c=t[o[1]];else{const e=new RegExp(`{{ ${o[1]} }}`);c=null==c?void 0:c.replace(e,t[o[1]]||"")}"function"==typeof c&&a in this.EVENTS?i.addEventListener(this.EVENTS[a],c):"class"===a&&void 0!==c&&i instanceof HTMLElement?i.className=String(c):void 0===r?i.setAttribute(a,"true"):i.setAttribute(a,String(c))}))}return s.forEach((e=>{i.appendChild(this._createNode(e,t))})),i}_createTree(e){const t=e.shift();if(/<([a-zA-Z]+.*?)|(\/[a-zA-Z]+)>/gi.test(t)){const s=t.replace(/(<)|(( .*?)?\/?>)/g,""),n=[],a=`</${s}>`;if(!(e=>/<[a-zA-Z]+.*?\/>/gi.test(e))(t)){for(;0!==e.length&&e[0]!==a;)n.push(this._createTree(e));e.shift()}return{tag:s,fullTag:t,children:n}}if("<>"===t){const s=[];for(;"</>"!==e[0];)s.push(this._createTree(e));return{tag:t,fullTag:t,children:s}}return t}_parseTemplate(e){return e.replace(/([\r\n]+)/g,"").replace(/ {2,}/g,"").match(/(<.*?>)|([^<]+)/gi).filter((e=>""!==e))}compile(e,t={}){const s=this._parseTemplate(e),n=this._createTree(s);return this._createNode(n,t)}}{constructor(){super(...arguments),this._allowed=t}};class n extends t{constructor(e){super(e)}render(){return s.compile('\n    <li class="chat-item-wrapper">\n        <div class="chat-item">\n            <img class="chat-item__avatar" src="{{ avatarSrc }}" alt="{{ avatarAlt }}" width="47" height="47" />\n            <h3 class="chat-item__title">\n                <a href="{{ chatUrl }}" class="chat-item__link">{{ chatName }}</a>\n            </h3>\n            <div class="chat-item__message">{{ chatMessage }}</div>\n            <div class="chat-item__time-wrapper">\n                <div class="chat-item__time">{{ date }}</div>\n            </div>\n            {{ newMessage }}\n        </div>\n    </li>\n',Object.assign({},this.props))}}class a extends t{constructor(e){super(e)}render(){return s.compile('\n    <div class="chat-item__new-message">\n        {{ count }}\n    </div>\n',Object.assign({},this.props))}}class i extends t{constructor(e){super(e)}render(){return s.compile('\n    <>\n        <span class="chat-item__you-label">Вы:</span> {{ message }}\n    </>\n',Object.assign({},this.props))}}const r=new class extends t{constructor(e){super(e)}render(){return s.compile('\n    <main class="wrapper-center">\n        Выберите чат, чтобы отправить сообщение\n    </main>\n')}}({}),c=[{avatarAlt:"Аватар беседы с Андреем",avatarSrc:"/assets/avatar.jpg",incomingMessage:"Изображение",chatName:"Андрей",chatUrl:"/pages/chat",date:"10:49",newMessage:2},{avatarAlt:"Аватар беседы Киноклуб",avatarSrc:"/assets/avatar.jpg",outgoingMessage:"стикер",chatName:"Киноклуб",chatUrl:"/pages/chat",date:"12:00"},{avatarAlt:"Аватар беседы с Илья",avatarSrc:"/assets/avatar.jpg",incomingMessage:"Друзья, у меня для вас особенный выпуск новостей! Тут еще текст, который не влезает",chatName:"Илья",chatUrl:"/pages/chat",date:"15:12",newMessage:4},{avatarAlt:"Аватар беседы с Вадимом",avatarSrc:"/assets/avatar.jpg",outgoingMessage:"Круто!",chatName:"Вадим",chatUrl:"/pages/chat",date:"Пт"},{avatarAlt:"Аватар беседы тет-а-теты",avatarSrc:"/assets/avatar.jpg",incomingMessage:"И Human Interface Guidelines и Material Design рекомендуют и еще текст, который не влезает",chatName:"тет-а-теты",chatUrl:"/pages/chat",date:"Ср"},{avatarAlt:"Аватар беседы 1, 2, 3",avatarSrc:"/assets/avatar.jpg",incomingMessage:"Миллионы россиян ежедневно проводят десятки часов свое и тут тоже есть текст, который не влезает",chatName:"1, 2, 3",chatUrl:"/pages/chat",date:"Пн"},{avatarAlt:"Аватар беседы Design Destroyer",avatarSrc:"/assets/avatar.jpg",incomingMessage:"В 2008 году художник Jon Rafman начал собирать - да-да, и этот текст тоже не влезает",chatName:"Design Destroyer",chatUrl:"/pages/chat",date:"Пн"},{avatarAlt:"Аватар беседы Day.",avatarSrc:"/assets/avatar.jpg",incomingMessage:"Так увлёкся работой по курсу, что совсем забыл его анонсировать - фух, это последний текст, который не влезает",chatName:"Day.",chatUrl:"/pages/chat",date:"31 Мая 2020"}].map((e=>{var{newMessage:t,incomingMessage:s,outgoingMessage:r}=e,c=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]])}return s}(e,["newMessage","incomingMessage","outgoingMessage"]);const o=Object.assign({},c);return void 0!==t&&(o.newMessage=new a({count:t})),void 0!==s?o.chatMessage=s:void 0!==r&&(o.chatMessage=new i({message:r})),new n(Object.assign({},o))}));((e,t)=>{const s=document.querySelector("#root"),n=t.getContent();null!==s&&null!==n&&(null==s||s.appendChild(n))})(0,new class extends t{constructor(e){super(e)}render(){return s.compile('\n    <div class="chats-wrapper">\n        <h1 class="visually-hidden">{{ pageTitle }}</h1>\n        <aside class="chats-wrapper__aside">\n            <div class="link-profile-wrapper">\n                <a href="/pages/profile" class="link-profile">Профиль</a>\n            </div>\n            <div class="chats-search">\n                <input type="search" class="chats-search__input js-input-search" placeholder="Поиск" name="search"  autocomplete="off" onChange="{{ onChange }}" />\n            </div>\n            <section class="chats-list">\n                <h2 class="visually-hidden">Список чатов</h2>\n                <ul class="chats-list__content">\n                    {{ chatItems }}\n                </ul>\n            </section>\n        </aside>\n        {{ content }}\n    </div>\n',Object.assign({},this.props))}}({chatItems:c,content:r,onChange:e=>{const{target:t}=e,{value:s}=t;console.log("search: "+s)},pageTitle:"Выбор чата"}))})();