(()=>{"use strict";class e{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){if(!this.listeners[e])throw new Error("Нет события: "+e);this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){if(!this.listeners[e])throw new Error("Нет события: "+e);this.listeners[e].forEach((function(e){e(...t)}))}}class t{constructor(n){this._element=null,this._mounted=!1,this.setProps=e=>{e&&Object.assign(this.props,e)};const i=new e;this.props=this._makePropsProxy(n),this.eventBus=()=>i,this._registerEvents(i),i.emit(t.EVENTS.INIT)}_registerEvents(e){e.on(t.EVENTS.INIT,this.init.bind(this)),e.on(t.EVENTS.FLOW_CDM,this._componentDidMount.bind(this)),e.on(t.EVENTS.FLOW_RENDER,this._render.bind(this)),e.on(t.EVENTS.FLOW_SCDU,this._shouldComponentDidUpdate.bind(this)),e.on(t.EVENTS.FLOW_CDU,this._componentDidUpdate.bind(this))}init(){this._prerender(),this._render()}_componentDidMount(){this.componentDidMount()}componentDidMount(){}_shouldComponentDidUpdate(e,n){this.shouldComponentUpdate(e,n)&&this.eventBus().emit(t.EVENTS.FLOW_RENDER)}shouldComponentUpdate(e,t){return e!==t}_componentDidUpdate(){this.componentDidUpdate()}componentDidUpdate(){}_render(){const e=this.render();this._mounted&&null!==this._element&&null!==e?this._element instanceof HTMLElement&&(this._element.replaceWith(e),this._element=e):this._element=e,this._mounted?this.eventBus().emit(t.EVENTS.FLOW_CDU):(this.eventBus().emit(t.EVENTS.FLOW_CDM),this._mounted=!0)}render(){return null}get element(){return this._element}getContent(){return this.element}_makePropsProxy(e){return new Proxy(e,{set:(e,n,i)=>(e[n]=i,this.eventBus().emit(t.EVENTS.FLOW_SCDU),!0)})}show(e="block"){this._element instanceof HTMLElement&&"none"===this._element.style.display&&(this._element.style.display=e,this.eventBus().emit(t.EVENTS.FLOW_CDU))}hide(){this._element instanceof HTMLElement&&"none"!==this._element.style.display&&(this._element.style.display="none",this.eventBus().emit(t.EVENTS.FLOW_CDU))}visibilityToggle(e="block"){this._element instanceof HTMLElement&&("none"===this._element.style.display?this.show(e):this.hide())}forceUpdate(){this.eventBus().emit(t.EVENTS.FLOW_RENDER)}_prerender(){this.prerender()}prerender(){}}t.EVENTS={INIT:"init",FLOW_CDM:"flow:component-did-mount",FLOW_RENDER:"flow:render",FLOW_SCDU:"flow:should-component-did-update",FLOW_CDU:"flow:component-did-update"};const n=new class extends class{constructor(){this._allowed=null,this.EVENTS={onBlur:"blur",onChange:"input",onClick:"click",onSubmit:"submit"},this.SVG_TAGS=["svg","circle","path","stroke","rect","line"]}_createNode(e,t){if("string"==typeof e){let n=e;const i=(e.match(/{{ (\w+) }}/g)||[]).reduce(((e,t)=>e.includes(t)?e:[...e,t.replace(/({)|(})|( )/g,"")]),[]),s=document.createDocumentFragment();for(const e of i){const i=new RegExp(`{{ ${e} }}`,"g");if(null!==this._allowed){if(t[e]instanceof this._allowed){const n=t[e].getContent();null!==n&&s.appendChild(n)}Array.isArray(t[e])&&t[e].forEach((e=>{const t=e.getContent();null!==t&&s.appendChild(t)}))}n=n.replace(i,t[e]||"")}return Array.from(s.children).length>0?s:document.createTextNode(n)}const{children:n,fullTag:i,tag:s}=e;if("<>"===s){const e=document.createDocumentFragment();return n.forEach((n=>{e.appendChild(this._createNode(n,t))})),e}const r=this.SVG_TAGS.includes(s)?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s),o=i.match(/([a-zA-Z0-9-]+)="(.*?)"/g);if(null!==o){const e=/(?<prop>[a-zA-Z0-9-]+)(="(?<value>.*?)")?/;o.forEach((n=>{var i;const{prop:s,value:o=""}=null===(i=n.match(e))||void 0===i?void 0:i.groups;let l=o;const a=null==o?void 0:o.match(/{{ (\w+) }}/);if(null!=a&&void 0!==a[1])if("function"==typeof t[a[1]])l=t[a[1]];else{const e=new RegExp(`{{ ${a[1]} }}`);l=null==l?void 0:l.replace(e,t[a[1]]||"")}"function"==typeof l&&s in this.EVENTS?r.addEventListener(this.EVENTS[s],l):"class"===s&&void 0!==l&&r instanceof HTMLElement?r.className=String(l):void 0===o?r.setAttribute(s,"true"):r.setAttribute(s,String(l))}))}return n.forEach((e=>{r.appendChild(this._createNode(e,t))})),r}_createTree(e){const t=e.shift();if(/<([a-zA-Z]+.*?)|(\/[a-zA-Z]+)>/gi.test(t)){const n=t.replace(/(<)|(( .*?)?\/?>)/g,""),i=[],s=`</${n}>`;if(!(e=>/<[a-zA-Z]+.*?\/>/gi.test(e))(t)){for(;0!==e.length&&e[0]!==s;)i.push(this._createTree(e));e.shift()}return{tag:n,fullTag:t,children:i}}if("<>"===t){const n=[];for(;"</>"!==e[0];)n.push(this._createTree(e));return{tag:t,fullTag:t,children:n}}return t}_parseTemplate(e){return e.replace(/([\r\n]+)/g,"").replace(/ {2,}/g,"").match(/(<.*?>)|([^<]+)/gi).filter((e=>""!==e))}compile(e,t={}){const n=this._parseTemplate(e),i=this._createTree(n);return this._createNode(i,t)}}{constructor(){super(...arguments),this._allowed=t}};class i extends t{constructor(e){super(e)}render(){const e=this.props,{writable:t}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}(e,["writable"]);return t?n.compile('\n    <div class="profile__row profile-row">\n        <div class="profile-row__title">{{ title }}</div>\n        <input type="{{ type }}" class="profile-row__value" value="{{ value }}" name="{{ name }}" />\n    </div>\n',Object.assign({},i)):n.compile('\n    <div class="profile__row profile-row">\n        <div class="profile-row__title">{{ title }}</div>\n        <div class="profile-row__value">{{ value }}</div>\n    </div>\n',Object.assign({},i))}}((e,t)=>{const n=document.querySelector("#root"),i=t.getContent();null!==n&&null!==i&&(null==n||n.appendChild(i))})(0,new class extends t{constructor(e){super(e)}render(){const e=this.props,{long:t}=e,i=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}(e,["long"]);return n.compile('\n    <div class="profile-page">\n        <div class="profile__back-link-wrapper">\n            <a href="/pages/chats" class="profile-back-link" title="Вернуться к выбору чата">\n                <svg width="13" height="12" viewBox="0 0 13 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <rect x="13" y="6.80005" width="11" height="1.6" transform="rotate(-180 13 6.80005)" fill="white" />\n                    <path d="M6 11L2 6L6 1" stroke="white" stroke-width="1.6" />\n                </svg>\n            </a>\n        </div>\n        <main class="profile {{ className }}">\n            <h1 class="visually-hidden">\n                {{ pageTitle }}\n            </h1>\n            <img src="{{ avatarSrc }}" alt="Аватар пользователя {{ displayName }}" width="131" height="131" />\n            <div class="profile__title">\n                {{ displayName }}\n            </div>\n            {{ content }}\n        </main>\n    </div>\n',Object.assign(Object.assign({},i),{className:t?"profile_long":""}))}}({avatarSrc:"/assets/avatar.jpg",content:[new class extends t{constructor(e){super(e)}render(){return n.compile('\n    <div class="profile-section">\n        {{ content }}\n    </div>\n',Object.assign({},this.props))}}({content:[new i({title:"Имя",value:"Вася"}),new i({title:"Фамилия",value:"Васин"}),new i({title:"Отображаемое имя",value:"Васян"}),new i({title:"Логин",value:"username"}),new i({title:"Почта",value:"pochta@yandex.ru"}),new i({title:"Телефон",value:"+7 903 123 4567"})]}),new class extends t{render(){return n.compile('\n    <div class="profile-section">\n        <div class="profile__row profile-row">\n            <a href="/pages/edit-profile" class="profile-row__link">Изменить данные</a>\n        </div>\n        <div class="profile__row profile-row">\n            <button class="profile-row__logout" type="button" onClick="{{ onClick }}">Выйти</button>\n        </div>\n    </div>\n',{onClick:()=>{console.log("logout")}})}}({})],displayName:"Васян",pageTitle:"Профиль"}))})();